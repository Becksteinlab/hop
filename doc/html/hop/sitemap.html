

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; Hop 0.3.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Hop 0.3.3 documentation" href="../index.html" />
    <link rel="up" title="Generating a hopping graph" href="../generate.html" />
    <link rel="next" title="qhull" href="qhull.html" />
    <link rel="prev" title="Generating a hopping graph" href="../generate.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="qhull.html" title="qhull"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../generate.html" title="Generating a hopping graph"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Hop 0.3.3 documentation</a> &raquo;</li>
          <li><a href="../hop.html" >Hop package &#8212; <tt class="docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal"><span class="pre">hop</span></tt></a> &raquo;</li>
          <li><a href="../generate.html" accesskey="U">Generating a hopping graph</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-hop.sitemap"></span><p>Histogram positions of particles from a MD trajectory on a
grid. Calculate the density, change units (both of the grid and of the
density), save the density, export into 3D visualization formats,
manipulate the density as a numpy array.</p>
<dl class="function">
<dt id="hop.sitemap.Bfactor2RMSF">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">Bfactor2RMSF</tt><big>(</big><em>B</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Bfactor2RMSF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Bfactor2RMSF" title="Permalink to this definition">¶</a></dt>
<dd><p>Atomic root mean square fluctuation (in Angstrom) from the crystallographic B-factor</p>
<p>B = [(8*PI**2)/3] * (RMSF)**2</p>
<p>Willis &amp; Pryor, Thermal vibrations in crystallography, Cambridge
Univ. Press, 1975</p>
</dd></dl>

<dl class="class">
<dt id="hop.sitemap.BfactorDensityCreator">
<em class="property">class </em><tt class="descclassname">hop.sitemap.</tt><tt class="descname">BfactorDensityCreator</tt><big>(</big><em>psf</em>, <em>pdb</em>, <em>delta=1.0</em>, <em>atomselection='name OH2'</em>, <em>metadata=None</em>, <em>padding=4.0</em>, <em>sigma=None</em>, <em>verbosity=3</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#BfactorDensityCreator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.BfactorDensityCreator" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a density grid from a pdb file using MDAnalysis.</p>
<blockquote>
<div>dens = BfactorDensityCreator(psf,pdb,...).PDBDensity()</div></blockquote>
<p>The main purpose of this function is to convert crystal waters in
an X-ray structure into a density so that one can compare the
experimental density with the one from molecular dynamics
trajectories. Because a pdb is a single snapshot, the density is
estimated by placing Gaussians of width sigma at the position of
all selected atoms.</p>
<p>Sigma can be fixed or taken from the B-factor field, in which case
sigma is taken as sqrt(3.*B/8.)/pi.</p>
<p>TODO:</p>
<ul class="simple">
<li>Make Gaussian convolution more efficient (at least for same
sigma) because right now it is VERY slow (which may be
acceptable if one only runs this once)</li>
<li>Using a temporary Creator class with the PDBDensity() helper
method is clumsy (but was chosen as to keep the PDBDensity class
clean and __init__ compatible with Density).</li>
</ul>
<dl class="method">
<dt id="hop.sitemap.BfactorDensityCreator.PDBDensity">
<tt class="descname">PDBDensity</tt><big>(</big><em>threshold=None</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#BfactorDensityCreator.PDBDensity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.BfactorDensityCreator.PDBDensity" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a PDBDensity object.</p>
<p>The PDBDensity is a Density with a xray2psf translation table;
it has also got an empty bulk site inserted (so that any
further analysis which assumes that site number 1 is the bulk)
does not discard a valid site.</p>
<dl class="docutils">
<dt>threshold      Use the given threshold to generate the graph; the threshold</dt>
<dd>is assumed to be in the same units as the density.
None: choose defaults (1.0 if bfactors were used, 1.3 otherwise)</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="hop.sitemap.Density">
<em class="property">class </em><tt class="descclassname">hop.sitemap.</tt><tt class="descname">Density</tt><big>(</big><em>grid=None</em>, <em>edges=None</em>, <em>filename=None</em>, <em>dxfile=None</em>, <em>parameters=None</em>, <em>unit=None</em>, <em>metadata=None</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density" title="Permalink to this definition">¶</a></dt>
<dd><p>Class with an annotated density, i.e. additional information
for each grid cell. Adds information about sites to the grid. A
&#8216;site&#8217; consists of all connected grid cells with a density &gt;=
threshold.</p>
<p>A site is defined as a set of at least &#8216;MINsite&#8217; grid cells with
density &gt;= threshold that are located in each others&#8217; first and
second nearest neighbour shell (of 26 cells, on the cubic
lattice). A site is labelled by an integer 1..N. The interstitial
is labelled &#8216;0&#8217;. By default, a site may consist of a single grid
cell (MINsite == 1) but this can be changed by setting the
parameter MINsite to another number &gt;1.</p>
<p>When neither grid nor edges are given then the density object can
also be read from a pickled file (filename) or a OpenDX file
(dxfile). In the latter case, care should be taken to properly set
up the units and the isDensity parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Density</span><span class="p">(</span><span class="n">dxfile</span><span class="o">=</span><span class="s">&#39;bulk.dx&#39;</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;isDensity&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s">&#39;MINsite&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
<span class="go">                unit={&#39;length&#39;:&#39;Angstrom&#39;,&#39;density&#39;:&#39;Angstrom&#39;}, ....)</span>
</pre></div>
</div>
<p>Attributes:</p>
<blockquote>
<div><p>grid          density on a grid
edges         the lower and upper edges of the grid cells along the</p>
<blockquote>
<div>three dimensions of the grid</div></blockquote>
<p>map           grid with cells labeled as sites (after label_sites())
sites         list of sites: site 0 is the interstitial, then follows</p>
<blockquote>
<div>the largest site, and then sites in decreasing order.
Each site is a list of tuples. Each tuple is the index
(i,j,k) into the map or grid.</div></blockquote>
<p>graph         NetworkX graph of the cells</p>
<p>unit          physical units of various components
P             (default) values of parameters</p>
</div></blockquote>
<p>Methods:</p>
<blockquote>
<div><dl class="docutils">
<dt>map_sites(threshold)</dt>
<dd>label all sites, defined by the threshold. The threshold
value is stored with the object as the default. The default
can be explicitly set as P[&#8216;threshold&#8217;]</dd>
</dl>
<p>save(filename)  save object.pickle 
load(filename)  restore object.pickle (or use d=Density(filename=&lt;filename&gt;))
export()        write density to a file for visualization
export_map()    write individual sites</p>
</div></blockquote>
<dl class="method">
<dt id="hop.sitemap.Density.export3D">
<tt class="descname">export3D</tt><big>(</big><em>filename=None</em>, <em>site_labels='default'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.export3D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.export3D" title="Permalink to this definition">¶</a></dt>
<dd><p>Export pdb and psf file of site centres for interactive visualization.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">density</span><span class="o">.</span><span class="n">export3D</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>filename     prefix for output files: </dt>
<dd>&lt;filename&gt;.psf, &lt;filename&gt;.pdb, and &lt;filename&gt;.vmd</dd>
</dl>
<p>site_labels  selects sites (See site_labels())</p>
<p>The method writes a psf and a pdb file from the site map,
suitable for visualization in, for instance, VMD. In addition,
a VMD tcl file is produced. When it is sourced in VMD then the
psf and pdb are loaded and site labels are shown next to the sites.</p>
<p>Sites are represented as residues of resname &#8216;NOD&#8217;; each site
is marked by one &#8216;ATOM&#8217; (of type CA) at the center of geometry
of the site.</p>
<p>Bulk and interstitial are always filtered from the list of
sites because they do not have a well defined center.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.export_map">
<tt class="descname">export_map</tt><big>(</big><em>labels='default'</em>, <em>format='dx'</em>, <em>directory=None</em>, <em>value='density'</em>, <em>combined=False</em>, <em>verbosity=3</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.export_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.export_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Write sites as a density file for visualization.</p>
<p>export_map(<a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs)</p>
<dl class="docutils">
<dt>labels=&#8217;default&#8217;  Select the sites that should be exported. Can be</dt>
<dd>a list of numbers (site labels) or one of the keywords 
recognized by site_labels() (qv). The interstitial is
always excluded.</dd>
<dt>combined=False     True: write one file. False: write one file for each</dt>
<dd>site.</dd>
</dl>
<p>format=&#8217;dx&#8217;        Only dx format supported
directory=&#8217;site_maps&#8217;</p>
<blockquote>
<div>Files are created in new directory, &#8216;site_maps&#8217; by
default. File names are generated and indexed with
the label of the site. By default, &#8216;site_maps&#8217; is
located in the same directory as the default filename.</div></blockquote>
<dl class="docutils">
<dt>value= &#8216;density&#8217;   Writes the actual density in the site.</dt>
<dd><dl class="first docutils">
<dt>&#8216;threshold&#8217; The densities have the threshold value wherever the</dt>
<dd>site is defined. Note that the interstitial (label = 0)
is also written.</dd>
</dl>
<p class="last">&lt;float&gt;     Writes the value &lt;float&gt; into the site.</p>
</dd>
</dl>
<p>verbosity=3        Set to 0 to disable status messages.</p>
<p>Quick hack to write out sites. Each site can be written as a
separate density file (combined=False) so that one can distinguish them
easily in say VMD. Display with</p>
<blockquote>
<div>vmd site_maps/<a href="#id3"><span class="problematic" id="id4">*</span></a>.dx</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.find_equivalence_sites_with">
<tt class="descname">find_equivalence_sites_with</tt><big>(</big><em>reference</em>, <em>fmt='%d*'</em>, <em>update_reference=True</em>, <em>use_ref_equivalencesites=False</em>, <em>verbosity=0</em>, <em>equivalence_graph='equivalence_graph.png'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.find_equivalence_sites_with"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.find_equivalence_sites_with" title="Permalink to this definition">¶</a></dt>
<dd><p>Find overlapping sites with a reference density and update site descriptions.</p>
<p>Density.find_equivalence_sites_with(ref)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>ref         a Density object defined on the same grid
fmt         python format string used for the equivalent_name, which should</p>
<blockquote>
<div>contain %d for the reference label number (max 10 chars)
(but see below for magical use of xray water names)</div></blockquote>
<dl class="docutils">
<dt>update_reference</dt>
<dd>True (default): Also update the site_properties in the
<em>reference</em> so that one can make graphs that highlight the
common sites. (This is recommended.)
False: don&#8217;t change the reference</dd>
<dt>use_ref_equivalencesites</dt>
<dd>True: use sites + equivalence sites from the reference density
False*: remove all equivalence sites als from the ref density</dd>
<dt>verbosity   For verbosity &gt;= 3 output some statistics; verbosity &gt;=5 also </dt>
<dd>returns the equivalence graph for analysis; verbosity &gt;= 7 
displays the graph (and saves to equivalence_graph.png).</dd>
</dl>
<p>An &#8216;equivalence site&#8217; is a site that contains all sites that
overlap in real space with another site in the reference
density. This also means that two or more sites in one density
can become considered equivalent if they both overlap with a
larger site in the other density, and it is also possible that
one creates &#8216;equivalence&#8217; chains (0,a) &lt;-&gt; (1,b) &lt;-&gt; (0,c) &lt;-&gt;
(1,d) (although (0,a) ~&lt;-&gt; (1,d), and by construction (0,a) ~&lt;-&gt;
(0,c) and (1,b) ~&lt;-&gt; (1,d)), leading to extensive equivalence
sites.</p>
<p>When hopping properties are computed, an equivalence site is
used instead of the individual sub sites.</p>
<p>The equivalence sites themselves are constructed as new sites
and added to the list of sites; their site numbers are
constructed by adding to the total number of existing
sites. Sub-sites are marked up by an entry of the equivalence
site&#8217;s site number in site_properties.equivalence_site.</p>
<p>The common sites are consecutively numbered, starting at 2,
from the one containing most sites to the one with fewest.</p>
<p>The method updates Density.site_properties.equivalent_name
with the new descriptor of the equivalent site. Equivalent
site names are consecutively numbered, starting at 2, and can
be optionally formatted with the fmt argument.</p>
<p>However, if the reference density was built from an X-ray density AND if
each site corresponds to single X-ray water molecule then the
equivalence names contain the water identifiers eg &#8216;W136&#8217; or
&#8216;W20_W34_W36&#8217;.</p>
<p>See the hop.sitemap.find_common_sites() function for more details.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.has_bulk">
<tt class="descname">has_bulk</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.has_bulk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.has_bulk" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <tt class="docutils literal"><span class="pre">True</span></tt> if a bulk site has been inserted and <tt class="docutils literal"><span class="pre">False</span></tt> otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.map_hilo">
<tt class="descname">map_hilo</tt><big>(</big><em>lomin=0.0</em>, <em>lomax=0.5</em>, <em>himin=2.72</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.map_hilo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.map_hilo" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Experimental</strong> mapping of low density sites together with high density ones.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first last docutils">
<dt><em>lomin</em></dt>
<dd><p class="first last">low-density sites must have a density &gt; <em>lomin</em> [0.0]</p>
</dd>
<dt><em>lomax</em></dt>
<dd><p class="first last">low-density sites must have a density &lt; <em>lomax</em> [0.5]</p>
</dd>
<dt><em>himin</em></dt>
<dd><p class="first last">high-density sites must have a density &gt; <em>himin</em> [2.72]</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.map_sites">
<tt class="descname">map_sites</tt><big>(</big><em>threshold=None</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.map_sites"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.map_sites" title="Permalink to this definition">¶</a></dt>
<dd><p>Find regions of connected density and label them consecutively</p>
<p>map_sites([threshold=&lt;threshold&gt;])</p>
<dl class="docutils">
<dt>threshold      Use the given threshold to generate the graph; the threshold</dt>
<dd>is assumed to be in the same units as the density.
(This updates the Density object&#8217;s threshold value as well.)</dd>
</dl>
<p>The interstitial has label &#8216;0&#8217;, the largest connected subgraph
has &#8216;1&#8217; etc. The sites (i.e.the list of indices into map/grid)
can be accesed as Density.sites[label].</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.masked_density">
<tt class="descname">masked_density</tt><big>(</big><em>density</em>, <em>site_labels</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.masked_density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.masked_density" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns only that portion of density that corresponds to
sites; everything else is zeroed.</p>
<p>masked = masked_density(density,sites)</p>
<p>Arguments:</p>
<p>density       a array commensurate with the map
site_labels   label or list of site labels</p>
<p>Results:</p>
<p>Returns numpy array of same shape as input with non-site cells zeroed.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.remove_equivalence_sites">
<tt class="descname">remove_equivalence_sites</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.remove_equivalence_sites"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.remove_equivalence_sites" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete equivalence sites and recompute site map.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.site_insert_bulk">
<tt class="descname">site_insert_bulk</tt><big>(</big><em>bulkdensity</em>, <em>bulklabel=1</em>, <em>force=False</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.site_insert_bulk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.site_insert_bulk" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a bulk site from a different density map as bulk site into this density.</p>
<p>site_insert_bulk(bulkdensity)</p>
<p>This is a bit of a hack. The idea is that one can use a site
from a different map (computed from the same trajectory with
the same grid!) and insert it into the current site map to
define a different functional region. Typically, the bulk site
is the largest site in bulkdensity (and has site label 1) but
if this is not the case manually choose the appropriate
bulklabel.</p>
<p>The site is always inserted as the bulk site in the current density.</p>
<p>Example:
&gt;&gt;&gt; bulkdensity = hop.interactive.make_density(psf,dcd,&#8217;bulk&#8217;,delta=1.0,</p>
<blockquote>
<div>atomselection=&#8217;name OH2 and not within 4.0 of protein&#8217;)</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bulkdensity</span><span class="o">.</span><span class="n">map_sites</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">density</span><span class="o">.</span><span class="n">site_insert_bulk</span><span class="p">(</span><span class="n">bulkdensity</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">density</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">bulkdensity</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.site_insert_nobulk">
<tt class="descname">site_insert_nobulk</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.site_insert_nobulk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.site_insert_nobulk" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert an empty bulk site for cases when this is convenient.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.site_labels">
<tt class="descname">site_labels</tt><big>(</big><em>include='default'</em>, <em>exclude='default'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.site_labels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.site_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of site labels, possibly filtered.</p>
<p>L = site_labels(include=&lt;inclusions&gt;,exclude=&lt;exclusions&gt;)</p>
<p>&lt;inclusions&gt; and &lt;exclusions&gt; consist of a list of site labels
(integers) and/or keywords that describe a site selection. All entries
in one list are logically ORed. All exclusions are then removed from
the inclusions and the final list of site labels is returned as a numpy
array. (As a special case, the argument need not be a list but can be a
single keyword or site label).</p>
<p>For convenience, some inclusions such as &#8216;subsites&#8217; and
&#8216;equivalencesites&#8217; automatically remove themselves from the exclusions.</p>
<p>For standard use the defaults should do what you expect, i.e. only see
the sites that are relevant or that have been mapped in a hopping
trajectory.</p>
<p>Set verbosity to 10 in order to see the parsed selection.</p>
<dl class="docutils">
<dt>&lt;inclusions&gt;</dt>
<dd><dl class="first docutils">
<dt>&#8216;all&#8217;       all mapped sites, including bulk and subsites of </dt>
<dd>equivalent sites (but read the NOTE below: set exclude=None)</dd>
<dt>&#8216;default&#8217;   all mapped sites, including bulk but excluding subsites</dt>
<dd>and interstitial</dd>
<dt>&#8216;sites&#8217;     all mapped sites, excluding bulk and interstitial</dt>
<dd>(removes &#8216;subsites&#8217; and &#8216;equivalencesites&#8217; from
exclusions)</dd>
</dl>
<p>&#8216;subsites&#8217;  all sites that have been renamed or aggreated into equivalence sites
&#8216;equivalencesites&#8217;</p>
<blockquote>
<div>only the equivalence sites</div></blockquote>
<p class="last">int, list   site label(s)</p>
</dd>
<dt>&lt;exclusions&gt;</dt>
<dd><dl class="first docutils">
<dt>&#8216;default&#8217;    equivalent to [&#8216;interstitial&#8217;,&#8217;subsites&#8217;]; always applied unless </dt>
<dd>exludsions=None is set!</dd>
</dl>
<p>None         do not apply any exclusions
&#8216;interstitial&#8217;</p>
<blockquote>
<div>exclude interstitial (almost no reason to
ever include it)</div></blockquote>
<dl class="docutils">
<dt>&#8216;subsites&#8217;   exclude sites that have been aggregated or</dt>
<dd>simply renamed as equivalence sites</dd>
<dt>&#8216;equivalencesites&#8217;</dt>
<dd>exclude equivalence sites (and possibly include subsites)</dd>
</dl>
<p class="last">&#8216;bulk&#8217;       exclude the bulk site</p>
</dd>
</dl>
<p>Provides the ordered list L of site labels, excluding sites listed in
the exclude list. Site labels are integers, starting from &#8216;0&#8217; (the
interstitial). These labels are the index into the site_properties[]
and sites[] arrays.</p>
<p>NOTE that by default the standard exclusions are already being applied
to any &#8216;include&#8217;; if one really wants all sites one has to set
exclude=None.</p>
<p>Exclusions are applied _after_ inclusions.</p>
<p>&#8216;site&#8217; discards the bulk site, self.P[&#8216;bulk_site&#8217;]; this parameter is
automatically set when adding the bulk site with site_insert_bulk().</p>
<p>See find_equivalence_sites_with() for more on equivalence sites and
subsites.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.site_occupancy">
<tt class="descname">site_occupancy</tt><big>(</big><em>**labelargs</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.site_occupancy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.site_occupancy" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the labels and the average/stdev occupancy of the labeled site(s).</p>
<p>labels, &lt;N&gt;, std(N) = site_coocupancy(include=&#8217;all&#8217; | &lt;int&gt; | &lt;list&gt;)</p>
<p>Average occupancy is the average number of water molecules on the site i:</p>
<blockquote>
<div>&lt;N_i&gt; = &lt;n_i&gt; * V_i</div></blockquote>
<p>where n_i is the average density of the site and V_i its volume.</p>
<p>The label selection arguments are directly passed to
site_labels() (see doc string).</p>
<p>If the interstitial is included then 0,0 is returned for the
interstitial site (so ignore those numbers).</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.site_remove_bulk">
<tt class="descname">site_remove_bulk</tt><big>(</big><em>force=False</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.site_remove_bulk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.site_remove_bulk" title="Permalink to this definition">¶</a></dt>
<dd><p>Cleanup bulk site.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.site_volume">
<tt class="descname">site_volume</tt><big>(</big><em>**labelargs</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.site_volume"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.site_volume" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the label(s) and volume(s) of the selected sites.</p>
<p>labels, volumes = site_volume(&#8216;all&#8217;)</p>
<p>The volume is calculated in the unit set in
unit[&#8216;length&#8217;]. The label selection arguments are directly
passed to site_labels() (see doc string).</p>
<p>The volume of the interstitial (if included) is returned as 0
(which is not correct but for technical reasons more
convenient).</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.stats">
<tt class="descname">stats</tt><big>(</big><em>data=None</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Statistics for the density (excludes bulk, interstitial, subsites).</p>
<p>d = stats([data=dict])</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Density.subsites_of">
<tt class="descname">subsites_of</tt><big>(</big><em>equivsites</em>, <em>kind='sitelabel'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Density.subsites_of"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Density.subsites_of" title="Permalink to this definition">¶</a></dt>
<dd><p>Return subsites of given equivalence sites as a dict.</p>
<p>dict &lt;&#8211; subsites_of(equivsites,kind=&#8217;sitelabel&#8217;)</p>
<p>The dict is indexed by equivsite label. There is one list of subsites for
each equivsitelabel.</p>
<dl class="docutils">
<dt>kind      &#8216;sitelabel&#8217;:  equivsites are the sitelabels as uses internally; this is</dt>
<dd><blockquote class="first">
<div>the default because site_labels() returns these numbers and
so  one can  directly use the output from site_labels() as
input (see example)</div></blockquote>
<dl class="last docutils">
<dt>&#8216;equivlabel&#8217;: equivsites are treated as labels of equivalence sites;</dt>
<dd>these are integers N that typically start at 2</dd>
<dt>&#8216;name&#8217;:       equivsites are treated as strings that are given as names</dt>
<dd>to sites; the default settings produce something like &#8216;N*&#8217;</dd>
</dl>
</dd>
</dl>
<p>EXAMPLES:</p>
<blockquote>
<div>dens.subsites_of(dens.site_labels(&#8216;equivalencesites&#8217;))
dens.subsites_of([2,5,10], kind=&#8217;equivsites&#8217;)
dens.subsites_of(&#8216;10*&#8217;, kind=&#8217;name&#8217;)</div></blockquote>
<p>NOTE:
* equivlabel == 0 is silently filtered (it is used as a merker for NO equivalence</p>
<blockquote>
<div>site)</div></blockquote>
<ul class="simple">
<li>empty equivalence sites show up as empty entries in the output dict; typically
this means that one gave the wrong input or kind</li>
</ul>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="hop.sitemap.Grid">
<em class="property">class </em><tt class="descclassname">hop.sitemap.</tt><tt class="descname">Grid</tt><big>(</big><em>grid=None</em>, <em>edges=None</em>, <em>filename=None</em>, <em>dxfile=None</em>, <em>parameters=None</em>, <em>unit=None</em>, <em>metadata=None</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Grid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Grid" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to manage a multidimensional grid object.</p>
<p>The grid (Grid.grid) can be manipulated as a standard numpy
array. Changes can be saved to a file using the save() method. The
grid can be restored using the load() method or by supplying the
filename to the constructor.</p>
<p>The attribute Grid.metadata holds a user-defined dictionary that
can be used to annotate the data. It is saved with save().</p>
<p>The export(format=&#8217;dx&#8217;) method always exports a 3D object, the
rest should work for an array of any dimension.</p>
<dl class="method">
<dt id="hop.sitemap.Grid.centers">
<tt class="descname">centers</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Grid.centers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Grid.centers" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the coordinates of the centers of all grid cells as an iterator.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Grid.convert_density">
<tt class="descname">convert_density</tt><big>(</big><em>unit='Angstrom'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Grid.convert_density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Grid.convert_density" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the density to the physical units given by unit</p>
<p>Grid.convert_to(&lt;unit&gt;)</p>
<p>&lt;unit&gt; can be one of the following:</p>
<p>Angstrom     particles/A**3
nm           particles/nm**3
SPC          density of SPC water at standard conditions
TIP3P        ... see __water__[&#8216;TIP3P&#8217;]
TIP4P        ... ...
water        density of real water at standard conditions (0.997 g/cm**3)
Molar        mol/l</p>
<dl class="docutils">
<dt>Note: (1) This only works if the initial length unit is provided.</dt>
<dd><ol class="first last arabic simple" start="2">
<li>Conversions always go back to unity so there can be rounding
and floating point artifacts for multiple conversions.</li>
</ol>
</dd>
</dl>
<p>There may be some undesirable cross-interactions with convert_length...</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Grid.convert_length">
<tt class="descname">convert_length</tt><big>(</big><em>unit='Angstrom'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Grid.convert_length"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Grid.convert_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Grid object to the new unit:
Grid.convert_length(&lt;unit&gt;)</p>
<p>unit       Angstrom, nm</p>
<p>This changes the edges but will not change the density; it is
the user&#8217;s responsibility to supply the appropriate unit if
the Grid object is constructed from a density. It is suggested
to start from a histogram and a length unit and use
make_density().</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Grid.export">
<tt class="descname">export</tt><big>(</big><em>filename=None</em>, <em>format='dx'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Grid.export"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Grid.export" title="Permalink to this definition">¶</a></dt>
<dd><p>export density to file using the given format; use &#8216;dx&#8217; for visualization.</p>
<p>export(filename=&lt;filename&gt;,format=&lt;format&gt;)</p>
<p>The &lt;filename&gt; can be omitted if a default file name already
exists for the object (e.g. if it was loaded from a file or it
was saved before.) Do not supply the filename extension. The
correct one will be added by the method.</p>
<p>The default format for export() is &#8216;dx&#8217;.</p>
<p>Only implemented formats:</p>
<p>dx        OpenDX (WRITE ONLY)
python    pickle (use Grid.load(filename) to restore); Grid.save()</p>
<blockquote>
<div>is simpler than export(format=&#8217;python&#8217;).</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Grid.importdx">
<tt class="descname">importdx</tt><big>(</big><em>dxfile</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Grid.importdx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Grid.importdx" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes Grid from a OpenDX file.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.Grid.make_density">
<tt class="descname">make_density</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#Grid.make_density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.Grid.make_density" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the grid (a histogram, counts in a cell) to a density (counts/volume).</p>
<p>make_density()</p>
<dl class="docutils">
<dt>Note: (1) This changes the grid irrevocably.</dt>
<dd><ol class="first last arabic simple" start="2">
<li>For a probability density, manually divide by grid.sum().</li>
</ol>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="hop.sitemap.PDBDensity">
<em class="property">class </em><tt class="descclassname">hop.sitemap.</tt><tt class="descname">PDBDensity</tt><big>(</big><em>grid=None</em>, <em>edges=None</em>, <em>filename=None</em>, <em>dxfile=None</em>, <em>parameters=None</em>, <em>unit=None</em>, <em>metadata=None</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#PDBDensity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.PDBDensity" title="Permalink to this definition">¶</a></dt>
<dd><p>Density with additional information about original crystal structure.</p>
<p>This is simply the Density class (see below) enhanced by the add_xray2psf(),
W(), and Wequiv() methods.</p>
<p>Note that later analysis often ignores the site with the bulknumber by default
so one should (after computing a site map) also insert an empty bulk site:</p>
<blockquote>
<div><p># canonical way to build a PDBDensity
# (builds the sitepa at threshold and inserts a pseudo bulk site)
xray = BfactorDensityCreator(...).PDBDensity(threshold)</p>
<p># rebuild site map
xray.map_sites(threshold) # map sites at density cutoff threshold
xray.site_insert_nobulk() # insert &#8216;fake&#8217; bulk site at position SITELABEL[&#8216;bulk&#8217;]</p>
<p># find X-ray waters that correspond to a site in another density Y:
# (1) build the list of equivalence sites, using the x-ray density as reference
Y.find_equivalence_sites(xray)     # also updates equiv-sites in xray!
# (2) look at the matches in xray
xray.Wequiv()        TODO: not working yet</p>
</div></blockquote>
<p>Density Class</p>
<dl class="docutils">
<dt>Class with an annotated density, i.e. additional information</dt>
<dd><p class="first">for each grid cell. Adds information about sites to the grid. A
&#8216;site&#8217; consists of all connected grid cells with a density &gt;=
threshold.</p>
<p>A site is defined as a set of at least &#8216;MINsite&#8217; grid cells with
density &gt;= threshold that are located in each others&#8217; first and
second nearest neighbour shell (of 26 cells, on the cubic
lattice). A site is labelled by an integer 1..N. The interstitial
is labelled &#8216;0&#8217;. By default, a site may consist of a single grid
cell (MINsite == 1) but this can be changed by setting the
parameter MINsite to another number &gt;1.</p>
<p>When neither grid nor edges are given then the density object can
also be read from a pickled file (filename) or a OpenDX file
(dxfile). In the latter case, care should be taken to properly set
up the units and the isDensity parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Density</span><span class="p">(</span><span class="n">dxfile</span><span class="o">=</span><span class="s">&#39;bulk.dx&#39;</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;isDensity&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s">&#39;MINsite&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
<span class="go">                unit={&#39;length&#39;:&#39;Angstrom&#39;,&#39;density&#39;:&#39;Angstrom&#39;}, ....)</span>
</pre></div>
</div>
<p>Attributes:</p>
<blockquote>
<div><p>grid          density on a grid
edges         the lower and upper edges of the grid cells along the</p>
<blockquote>
<div>three dimensions of the grid</div></blockquote>
<p>map           grid with cells labeled as sites (after label_sites())
sites         list of sites: site 0 is the interstitial, then follows</p>
<blockquote>
<div>the largest site, and then sites in decreasing order.
Each site is a list of tuples. Each tuple is the index
(i,j,k) into the map or grid.</div></blockquote>
<p>graph         NetworkX graph of the cells</p>
<p>unit          physical units of various components
P             (default) values of parameters</p>
</div></blockquote>
<p>Methods:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>map_sites(threshold)</dt>
<dd>label all sites, defined by the threshold. The threshold
value is stored with the object as the default. The default
can be explicitly set as P[&#8216;threshold&#8217;]</dd>
</dl>
<p>save(filename)  save object.pickle 
load(filename)  restore object.pickle (or use d=Density(filename=&lt;filename&gt;))
export()        write density to a file for visualization
export_map()    write individual sites</p>
</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="hop.sitemap.PDBDensity.W">
<tt class="descname">W</tt><big>(</big><em>N</em>, <em>returntype='auto'</em>, <em>format=False</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#PDBDensity.W"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.PDBDensity.W" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the resid of water N.</p>
<p>If returntype == &#8216;psf&#8217; then N is interpreted as the resid in the
x-ray crystal structure (or original pdb file) and a resid N&#8217; in the
psf is returned.</p>
<p>If returntype == &#8216;xray&#8217; then N is a resid in the psf and the
corresponding crystal structure water is returned. This is
useful to label water molecules by their published identifier,
eg &#8216;W128&#8217;.</p>
<p>If the returntype is set to &#8216;auto&#8217; and N starts with a W (eg
&#8216;W128&#8217;) then it is assumed to be a crystal water and the
returntype is automatically set to psf, otherwise it acts like
&#8216;xray&#8217;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>N              resid of molecule (can be an iterable)
returntype     &#8216;auto&#8217; | &#8216;psf&#8217; | &#8216;xray&#8217;
format         False: return a integer number</p>
<blockquote>
<div><p>True: default string (either &#8220;WN&#8217;&#8221; for x-ray or &#8220;#N&#8217;&#8221; for psf)
python format string: if the string contains %(resid)d then the string</p>
<blockquote>
<div>will be used as a format, otherwise the bare number
is returned without raising an error</div></blockquote>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.PDBDensity.Wequiv">
<tt class="descname">Wequiv</tt><big>(</big><em>format=True</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#PDBDensity.Wequiv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.PDBDensity.Wequiv" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of the PDB resids of the equivalent sites.</p>
<p>array = Wequiv(format=True)</p>
<dl class="docutils">
<dt>format        True: array of identifiers &#8216;Wnn&#8217;</dt>
<dd>False: array of integers
string: python format string; %(resid)d is replaced</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.PDBDensity.add_xray2psf">
<tt class="descname">add_xray2psf</tt><big>(</big><em>pdbfile</em>, <em>regex='\s*W\s*|HOH|WAT|.*TIP.*|.*SPC.*'</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#PDBDensity.add_xray2psf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.PDBDensity.add_xray2psf" title="Permalink to this definition">¶</a></dt>
<dd><p>Add translation table between sequential psf numbering and original pdb numbering for water.</p>
<p>D.add_xray2psf(pdbfilename)</p>
<p>The original pdb is read and all water molecules are sequentially mapped
to the water molecules in the psf (without any checks). The pdb is read
and analyzed using Bio.PDB.</p>
<p>pdbfilename    Original crystallographic pdb file
regex          extended regular expression to detect water   residues</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.PDBDensity.equivalence_sites">
<tt class="descname">equivalence_sites</tt><big>(</big><em>format=True</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#PDBDensity.equivalence_sites"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.PDBDensity.equivalence_sites" title="Permalink to this definition">¶</a></dt>
<dd><p>All equivalence sites (if defined) together with crystallographic water labels.</p>
<p>recarray &lt;&#8211; equivalence_sites(self,format=True)</p>
<dl class="docutils">
<dt>The numpy.recarray has columns</dt>
<dd>equivalence_label        the integer label of the equivalence site
equivalence_name         the name, a string
xray                     the identifier of the X-ray water</dd>
</dl>
<p>equivalence_label and equivalence_name are identical between the densities from
which the equivalence sites were computed. The xray identifier is specific for the
structure; by default it is a string such as &#8216;W135&#8217;.</p>
<dl class="docutils">
<dt>format        True: print &#8216;W&lt;N&gt;&#8217; identifier</dt>
<dd>False: integer &lt;N&gt;
(see W() for more possibilities)</dd>
</dl>
<p>BUG: THIS IS NOT WORKING AS THOUGHT BECAUSE THERE IS NO 1-1
MAPPING BETWEEN WATER MOLECULES AND SITES AND BECAUSE SITES
ARE NOT NUMBERED IN THE SAME ORDER AS THE WATER MOLECULES</p>
<p>TODO: The proper way to do this is to find all water molecules
within a cutoff of each grid cell that belongs to a site and
then store all the waters as the string name of the site.</p>
</dd></dl>

<dl class="method">
<dt id="hop.sitemap.PDBDensity.site2resid">
<tt class="descname">site2resid</tt><big>(</big><em>sitelabel</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#PDBDensity.site2resid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.PDBDensity.site2resid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the resid of the particle that provided the density  for the site.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="hop.sitemap.density_from_Universe">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">density_from_Universe</tt><big>(</big><em>universe</em>, <em>delta=1.0</em>, <em>atomselection='name OH2'</em>, <em>metadata=None</em>, <em>padding=2.0</em>, <em>cutoff=0</em>, <em>soluteselection=None</em>, <em>verbosity=3</em>, <em>use_kdtree=True</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#density_from_Universe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.density_from_Universe" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a density grid from a MDAnalysis.Universe object.</p>
<blockquote>
<div>density_from_dcd(universe, delta=1.0, atomselection=&#8217;name OH2&#8217;, ...) &#8211;&gt; density</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first docutils">
<dt>universe</dt>
<dd><p class="first last"><tt class="xref py py-class docutils literal"><span class="pre">MDAnalysis.Universe</span></tt> object with a trajectory</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first docutils">
<dt>atomselection</dt>
<dd><p class="first last">selection string (MDAnalysis syntax) for the species to be analyzed
[&#8220;name OH2&#8221;]</p>
</dd>
<dt>delta</dt>
<dd><p class="first last">approximate bin size for the density grid in Angstroem (same in x,y,z)
(It is slightly adjusted when the box length is not an integer multiple
of delta.) [1.0]</p>
</dd>
<dt>metadata</dt>
<dd><p class="first last">dictionary of additional data to be saved with the object</p>
</dd>
<dt>padding </dt>
<dd><p class="first last">increase histogram dimensions by padding (on top of initial box size)
in Angstroem [2.0]</p>
</dd>
<dt>soluteselection</dt>
<dd><p class="first last">MDAnalysis selection for the solute, e.g. &#8220;protein&#8221; [<tt class="docutils literal"><span class="pre">None</span></tt>]</p>
</dd>
<dt>cutoff  </dt>
<dd><p class="first last">With <em>cutoff</em>, select &#8216;&lt;atomsel&gt; NOT WITHIN &lt;cutoff&gt; OF &lt;soluteselection&gt;&#8217;
(Special routines that are faster than the standard AROUND selection) [0]</p>
</dd>
<dt>verbosity: int  </dt>
<dd><p class="first last">level of chattiness; 0 is silent, 3 is verbose [3]</p>
</dd>
<dt>parameters  </dt>
<dd><p class="first last">dict with some special parameters for <a class="reference internal" href="#hop.sitemap.Density" title="hop.sitemap.Density"><tt class="xref py py-class docutils literal"><span class="pre">Density</span></tt></a> (see doc)</p>
</dd>
<dt>kwargs  </dt>
<dd><p class="first last">metadata, parameters are modified and passed on to <a class="reference internal" href="#hop.sitemap.Density" title="hop.sitemap.Density"><tt class="xref py py-class docutils literal"><span class="pre">Density</span></tt></a></p>
</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last"><a class="reference internal" href="#hop.sitemap.Density" title="hop.sitemap.Density"><tt class="xref py py-class docutils literal"><span class="pre">hop.sitemap.Density</span></tt></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.density_from_trajectory">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">density_from_trajectory</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#density_from_trajectory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.density_from_trajectory" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a density grid from a trajectory.</p>
<blockquote>
<div>density_from_trajectory(PSF, DCD, delta=1.0, atomselection=&#8217;name OH2&#8217;, ...) &#8211;&gt; density</div></blockquote>
<p>or</p>
<blockquote>
<div>density_from_trajectory(PDB, XTC, delta=1.0, atomselection=&#8217;name OH2&#8217;, ...) &#8211;&gt; density</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first docutils">
<dt>psf/pdb/gro     </dt>
<dd><p class="first last">topology file</p>
</dd>
<dt>dcd/xtc/trr/pdb</dt>
<dd><p class="first last">trajectory; if reading a single PDB file it is sufficient to just provide it
once as a single argument</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first docutils">
<dt>atomselection</dt>
<dd><p class="first last">selection string (MDAnalysis syntax) for the species to be analyzed
[&#8220;name OH2&#8221;]</p>
</dd>
<dt>delta</dt>
<dd><p class="first last">approximate bin size for the density grid in Angstroem (same in x,y,z)
(It is slightly adjusted when the box length is not an integer multiple
of delta.) [1.0]</p>
</dd>
<dt>metadata</dt>
<dd><p class="first last">dictionary of additional data to be saved with the object</p>
</dd>
<dt>padding </dt>
<dd><p class="first last">increase histogram dimensions by padding (on top of initial box size)
in Angstroem [2.0]</p>
</dd>
<dt>soluteselection</dt>
<dd><p class="first last">MDAnalysis selection for the solute, e.g. &#8220;protein&#8221; [<tt class="docutils literal"><span class="pre">None</span></tt>]</p>
</dd>
<dt>cutoff  </dt>
<dd><p class="first last">With <em>cutoff</em>, select &#8216;&lt;atomsel&gt; NOT WITHIN &lt;cutoff&gt; OF &lt;soluteselection&gt;&#8217;
(Special routines that are faster than the standard AROUND selection) [0]</p>
</dd>
<dt>verbosity: int  </dt>
<dd><p class="first last">level of chattiness; 0 is silent, 3 is verbose [3]</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"><p class="first"><a class="reference internal" href="#hop.sitemap.Density" title="hop.sitemap.Density"><tt class="xref py py-class docutils literal"><span class="pre">hop.sitemap.Density</span></tt></a></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Todo :</th><td class="field-body"><ul class="first last simple">
<li>Should be able to also set skip and start/stop for data collection.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">In order to calculate the bulk density, use</p>
<blockquote>
<div><p>atomselection=&#8217;name OH2&#8217;,soluteselection=&#8217;protein and not name H*&#8217;,cutoff=3.5</p>
</div></blockquote>
<p>This will select water oxygens not within 3.5 A of the protein heavy atoms.
Alternatively, use the VMD-based  <a class="reference internal" href="#hop.sitemap.density_from_volmap" title="hop.sitemap.density_from_volmap"><tt class="xref py py-func docutils literal"><span class="pre">density_from_volmap()</span></tt></a> function.</p>
</li>
<li><p class="first">The histogramming grid is determined by the initial frames min and max.</p>
</li>
<li><p class="first">metadata will be populated with psf, dcd, and a few other items.
This allows more compact downstream processing.</p>
</li>
</ul>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">docs for <a class="reference internal" href="#hop.sitemap.density_from_Universe" title="hop.sitemap.density_from_Universe"><tt class="xref py py-func docutils literal"><span class="pre">density_from_Universe()</span></tt></a> (defaults for kwargs are defined there).</p>
</div>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.density_from_volmap">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">density_from_volmap</tt><big>(</big><em>psf</em>, <em>dcd</em>, <em>dx=None</em>, <em>delta=1.0</em>, <em>atomselection='name OH2'</em>, <em>metadata=None</em>, <em>verbosity=3</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#density_from_volmap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.density_from_volmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the density using VMD&#8217;s VolMap plugin and an intermediate dx file.</p>
<dl class="docutils">
<dt>density_from_volmap(psf,dcd,dx,delta=1.0,atomselection=&#8217;name OH2&#8217;,</dt>
<dd>metadata=dict(psf=psf,dcd=dcd,system=&#8217;I-FABP apo&#8217;)</dd>
</dl>
<p>psf     Charmm psf topology file
dcd     Charmm trajectory
dx      dx file that holds the density generated by VolMap; if not provided a</p>
<blockquote>
<div>temporary file is created (and deleted)</div></blockquote>
<dl class="docutils">
<dt>atomselection</dt>
<dd>selection string (MDAnalysis syntax) for the species to be analyzed</dd>
<dt>delta   approximate bin size for the density grid (same in x,y,z)</dt>
<dd>(It is slightly adjusted when the box length is not an integer multiple
of delta.)</dd>
</dl>
<p>verbosity=int  level of chattiness; 0 is silent, 3 is verbose</p>
<p><a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs   metadata and parameters are passed to Density(), everything else to VolMap</p>
<blockquote>
<div><p>Density args:
metadata       dictionary of additional data to be saved with the object
parameters     dict of special Density parameters (see Density() doc)</p>
<p>VolMap args: 
load_new       True: load psf and dcd into VMD. False: use psf and dcd already</p>
<blockquote>
<div>loaded into VMD (default is True)</div></blockquote>
</div></blockquote>
<p>Returns a Density object.</p>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.find_common_sites">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">find_common_sites</tt><big>(</big><em>a</em>, <em>b</em>, <em>use_equivalencesites=None</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#find_common_sites"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.find_common_sites" title="Permalink to this definition">¶</a></dt>
<dd><p>Find sites that overlap in space in Density a and b.</p>
<p>m = find_common_sites(a,b)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>a        Density instance
b        Density instance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>array of mappings between sites in a and b that overlap
m[:,0]     site labels in a
m[:,1]     site labels in b
dict(m)    translates labels in a to labels in b
dict(m[:,[1,0]])</p>
<blockquote>
<div>translates labels in b to labels in a</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.find_overlap_coeff">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">find_overlap_coeff</tt><big>(</big><em>a</em>, <em>b</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#find_overlap_coeff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.find_overlap_coeff" title="Permalink to this definition">¶</a></dt>
<dd><p>Find sites that overlap in space in Density a and b.</p>
<p>m = find_overlap_coeff(a,b)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>a        Density instance
b        Density instance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>array sites in a and b that overlap</dt>
<dd>and array of probability of overlap for overlapped sites</dd>
</dl>
<p>m[:,0]     site labels in a
m[:,1]     site labels in b
oc         amount of overlap</p>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.notwithin_coordinates_factory">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">notwithin_coordinates_factory</tt><big>(</big><em>universe</em>, <em>sel1</em>, <em>sel2</em>, <em>cutoff</em>, <em>not_within=True</em>, <em>use_kdtree=True</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#notwithin_coordinates_factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.notwithin_coordinates_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate optimized selection for &#8216;<em>sel1</em> not within <em>cutoff</em> of <em>sel2</em>&#8216;</p>
<dl class="docutils">
<dt>Example usage::</dt>
<dd>notwithin_coordinates = notwithin_coordinates_factory(universe, &#8216;name OH2&#8217;,&#8217;protein and not name H*&#8217;,3.5)
...
coord = notwithin_coordinates()        # changes with time step
coord = notwithin_coordinates(cutoff2) # can use different cut off</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first last docutils">
<dt>not_within</dt>
<dd><p class="first last">True: selection behaves as &#8216;not within&#8217; (As described above)
False: selection is a &lt;sel1&gt; WITHIN &lt;cutoff&gt; OF &lt;sel2&gt;&#8217;</p>
</dd>
<dt>use_kdtree</dt>
<dd><p class="first last">True: use fast kd-tree based selections (requires new MDAnalysis &gt;= 0.6)
False: use distance matrix approach</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Periodic boundary conditions are NOT taken into account: the naive
minimum image convention employed in the distance check is currently
not being applied to remap the coordinates themselves, and hence it
would lead to counts in the wrong region.</li>
<li>The selections are static and do not change with time steps.</li>
</ul>
</div>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.print_combined_equivalence_sites">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">print_combined_equivalence_sites</tt><big>(</big><em>target</em>, <em>reference</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#print_combined_equivalence_sites"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.print_combined_equivalence_sites" title="Permalink to this definition">¶</a></dt>
<dd><p>Tabulate equivalence sites of target against the reference.</p>
<p>BUG: THIS IS NOT WORKING (because the assignment sites &lt;&#8211;&gt; waters
is broken)</p>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.remap_density">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">remap_density</tt><big>(</big><em>density</em>, <em>ref</em>, <em>verbosity=0</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#remap_density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.remap_density" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform a Density object to a grid given by a reference Density.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">newdensity</span> <span class="o">=</span> <span class="n">remap_density</span><span class="p">(</span><span class="n">old</span><span class="p">,</span><span class="n">ref</span><span class="p">)</span>
</pre></div>
</div>
<p>The user is repsonsible to guarantee that:
* the grid spacing is the same in both densities
* the grids only differ by a translation, not a rotation</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>old          Density object with site map
ref          reference Density object that provides the new grid shape
verbosity=0  increase to up to 3 for status and diagnostic messages</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>newdensity   Density object with old&#8217;s density and site map transformed</dt>
<dd><p class="first">to ref&#8217;s coordinate system. It is now possible to manipulate
newdensity&#8217;s and ref&#8217;s arrays (grid and map) together, e.g.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">common</span> <span class="o">=</span> <span class="p">(</span><span class="n">newdensity</span><span class="o">.</span><span class="n">map</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;</span> <span class="n">ref</span><span class="o">.</span><span class="n">map</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pairs</span> <span class="o">=</span> <span class="n">newdensity</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">common</span><span class="p">],</span> <span class="n">ref</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">common</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
<p>Note that this function is not well implemented at the moment and
can take a considerable amount of time on bigger grids
(100x100x100 take about 3 Min).</p>
<p>An implicit assumption is that the two coordinate systems for the
two grids are parallel and are only offset by a translation. This
cannot be checked based on the available data and must be
guaranteed by the user. RMS-fitting the trajectories is sufficient
for this to hold.</p>
<p>BUGS:</p>
<ul class="simple">
<li>This is not a good way to do the remapping: It requires parallel
coordinate systems and the exact same delta.</li>
<li>It is slow.</li>
<li>It would be much better to interpolate density on the reference grid,</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="hop.sitemap.unique_tuplelist">
<tt class="descclassname">hop.sitemap.</tt><tt class="descname">unique_tuplelist</tt><big>(</big><em>x</em><big>)</big><a class="reference internal" href="../_modules/hop/sitemap.html#unique_tuplelist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#hop.sitemap.unique_tuplelist" title="Permalink to this definition">¶</a></dt>
<dd><p>Sort a list of tuples and remove all values None</p>
</dd></dl>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../generate.html"
                        title="previous chapter">Generating a hopping graph</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="qhull.html"
                        title="next chapter">qhull</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/hop/sitemap.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="qhull.html" title="qhull"
             >next</a> |</li>
        <li class="right" >
          <a href="../generate.html" title="Generating a hopping graph"
             >previous</a> |</li>
        <li><a href="../index.html">Hop 0.3.3 documentation</a> &raquo;</li>
          <li><a href="../hop.html" >Hop package &#8212; <tt class="docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal"><span class="pre">hop</span></tt></a> &raquo;</li>
          <li><a href="../generate.html" >Generating a hopping graph</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Thomas B. Woolf, Oliver Beckstein.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>